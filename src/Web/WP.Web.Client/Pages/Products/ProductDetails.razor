@page "/products/{id:guid}"
@rendermode InteractiveWebAssembly
@using WP.Web.Client.Models
@using WP.Web.Client.Services
@inject ICatalogService CatalogService
@inject NavigationManager Navigation

<PageTitle>Product Details</PageTitle>

<div class="container mt-4">
    @if (isLoading)
    {
        <div class="text-center">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    }
    else if (product == null)
    {
        <div class="alert alert-warning">Product not found</div>
    }
    else
    {
        <div class="row">
            <div class="col-md-6">
                <img src="@(string.IsNullOrEmpty(product.Image) ? "https://via.placeholder.com/500" : product.Image)" 
                     class="img-fluid rounded" alt="@product.Name" />
            </div>
            <div class="col-md-6">
                <h1>@product.Name</h1>
                <p class="text-muted">@product.Description</p>
                <h2 class="text-primary">$@product.Value.ToString("F2")</h2>
                <div class="mb-3">
                    <span class="badge @(product.Active ? "bg-success" : "bg-secondary") me-2">
                        @(product.Active ? "Active" : "Inactive")
                    </span>
                    <span class="badge bg-info">Stock: @product.StockQuantity units</span>
                </div>
                <p><strong>Registered:</strong> @product.RegisterDate.ToString("dd/MM/yyyy HH:mm")</p>
                <div class="btn-group">
                    <button class="btn btn-primary" @onclick="EditProduct">
                        <i class="bi bi-pencil"></i> Edit
                    </button>
                    <button class="btn btn-danger" @onclick="DeleteProduct">
                        <i class="bi bi-trash"></i> Delete
                    </button>
                    <button class="btn btn-secondary" @onclick="GoBack">
                        <i class="bi bi-arrow-left"></i> Back
                    </button>
                </div>
            </div>
        </div>
    }
</div>

@code {
    [Parameter]
    public Guid Id { get; set; }

    private ProductDto? product;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        await LoadProduct();
    }

    private async Task LoadProduct()
    {
        isLoading = true;
        product = await CatalogService.GetProductByIdAsync(Id);
        isLoading = false;
    }

    private void EditProduct()
    {
        Navigation.NavigateTo($"/products/edit/{Id}");
    }

    private async Task DeleteProduct()
    {
        if (await JSRuntime.InvokeAsync<bool>("confirm", "Are you sure you want to delete this product?"))
        {
            var result = await CatalogService.DeleteProductAsync(Id);
            if (result.Success)
            {
                Navigation.NavigateTo("/products");
            }
        }
    }

    private void GoBack()
    {
        Navigation.NavigateTo("/products");
    }

    [Inject]
    private IJSRuntime JSRuntime { get; set; } = null!;
}
